import{r as n,aj as c,u as $,s as k,ak as ee,j as s,a as t,A as B,b as T,d as U,e as V,f as q,g as W,af as i,h as H,i as G,B as g,k as Q,F as R,L,I as _,E as N,o as ae,D as ie,al as be,m as O,ac as Ae,ad as Ne,ae as X,ag as Y,U as Ie,am as z,G as Ce,a6 as Fe,a8 as Se,a9 as Pe,aa as ye,ab as we,an as Re,l as se,ao as Le,v as Me,C as J,n as Ee,p as De,c as Oe,R as ze,ap as ke,aq as ue,ar as le,as as de,at as Be,au as he,av as pe,aw as Te}from"./modal-dados-pessoais-BO-Gi7V7.js";import{p as xe}from"./fetch-D7jVMcMU.js";function Ue({model:e}){var b,A,j,I,C,S,F;const[a,r]=n.useState(!1),o=n.useRef(null),l=n.useRef(null),p=n.useRef(null),h=!c(e.infoMessage)&&!c(e.submitNIFForm.username)||e.usernameReadonly||e.isMultipleAuthentication&&!c(e.nifInAuthentication),u=$({initialValues:{username:e.isMultipleAuthentication&&!c(e.nifInAuthentication)?e.nifInAuthentication:c(e.submitNIFForm.username)?e.is2FA?e.nifIn2FA:"":e.submitNIFForm.username,password:e.is2FA?"*********":"",envioDadosPessoais:!1},validate:{username:f=>k({required:!0,value:f,validator:ee}),password:f=>k({required:!0,value:f,minLength:8,maxLength:16})}});n.useEffect(()=>{const f=setTimeout(()=>{h?p.current.focus():l.current.focus()},1);return()=>clearTimeout(f)},[]);const m=f=>{var x;f.preventDefault(),u.validate().hasErrors||(((x=e.sisPart)==null?void 0:x.fPermissaoPartilhaDados)==="V"?r(!0):o.current.submit())};return s.jsxs("form",{name:"loginForm",autoComplete:"off",ref:o,onSubmit:m,className:t("d-flex","flex-column","gap-2"),noValidate:!0,action:e.urlLogin,method:"POST",children:[s.jsx(B,{open:a,children:s.jsxs(T,{color:"neutral",size:"md",children:[s.jsx(U,{children:s.jsx(V,{children:"Consentimento de Dados Pessoais"})}),s.jsx(q,{children:s.jsxs(W,{children:[s.jsx("div",{className:i.wrapperLogoSP,children:s.jsx("img",{className:t(i.logoSP,"p-0"),alt:"Logo "+((b=e.sisPart)==null?void 0:b.ndescr),src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)})}),s.jsx("br",{}),"Autorizo que o meu ",s.jsx("b",{children:"NÃºmero de Contribuinte"})," e ",s.jsx("b",{children:"Nome"})," sejam fornecidos Ã  entidade ",s.jsx("b",{children:(A=e.sisPart)==null?void 0:A.ndescr}),"."]})}),s.jsxs(H,{className:t("d-flex","gap-2"),children:[s.jsx(G,{children:s.jsx(g,{className:"secundaryButton",onClick:()=>r(!1),children:"NÃ£o Autorizo"})}),s.jsx(Q,{children:s.jsx(g,{className:"primaryButton",onClick:()=>o.current.submit(),children:"Autorizo"})})]})]})}),s.jsxs(R,{children:[s.jsx(L,{containerProps:{className:"d-none"},children:"NÃºmero de Contribuinte"}),s.jsx(_,{name:"username",showClearButton:"auto",ref:l,"aria-label":"NÃºmero de Contribuinte",title:"Insira um nÃºmero de contribuÃ­nte vÃ¡lido",placeholder:"NÃºmero de Contribuinte",readOnly:h,...u.getInputProps("username"),status:!c(u.errors.username)||((j=e.fieldError)==null?void 0:j.field)==="username"&&((I=e.submitNIFForm)==null?void 0:I.selectedAuthMethod)==="N"?"invalid":void 0,endAdornment:s.jsx(ae,{errorValue:u.errors.username}),startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]}),s.jsxs(R,{className:"hideLabel",children:[s.jsx(L,{containerProps:{className:"d-none"},children:"Senha de acesso"}),s.jsx(ie,{spellCheck:!1,name:"password",placeholder:"Senha de Acesso",errorValue:u.errors.password,passwordref:p,showClearButton:"auto",title:"Campo ObrigatÃ³rio",...u.getInputProps("password"),status:!c(u.errors.password)||((C=e.fieldError)==null?void 0:C.field)==="password"&&((S=e.submitNIFForm)==null?void 0:S.selectedAuthMethod)==="N"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Password",icon:"key",title:"Password",size:"xl"})})})]}),((F=e.sisPart)==null?void 0:F.fPermissaoPartilhaDados)==="V"&&s.jsx("input",{type:"hidden",name:"envioDadosPessoais",value:"on"}),e.attributes&&Object.keys(e.attributes).map(f=>s.jsx("input",{type:"hidden",name:f,value:e.attributes[f]},f)),s.jsx("input",{type:"hidden",name:"selectedAuthMethod",value:"N"}),s.jsx("input",{type:"hidden",name:e._csrf.parameterName,value:e._csrf.token}),e.attributes&&Object.keys(e.attributes).find(f=>f==="authVersion")==null&&s.jsx("input",{type:"hidden",name:"authVersion",value:e.authVersion}),s.jsx(g,{type:"submit",className:"primaryButton",children:"Autenticar"}),e.submitNIFForm.predefinedUsername&&s.jsx("input",{type:"hidden",name:"predefinedUsername",value:e.submitNIFForm.predefinedUsername}),e.isMultipleAuthentication&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"hidden",name:"nifInAuthentication",value:e.nifInAuthentication}),e.multipleAuthenticationRequestId&&s.jsx("input",{type:"hidden",name:"multipleAuthenticationRequestId",value:e.multipleAuthenticationRequestId})]})]})}function Ve({model:e,selectedTab:a}){var F,f,y,x,M,P,E;const r=n.useRef(null),o=n.useRef(null),l=n.useRef(null),[p,h]=n.useState(!1),u=e.attributes?e.attributes.nifRepresentado:null,m=e.attributes?e.attributes.idRepresentado:null,b=e.attributes?e.attributes.nifRepresentante:null,A=e.attributes?e.attributes.idRepresentante:null,j=u||m,I=b||(e.submitNIFForm.username?e.submitNIFForm.username:A);n.useEffect(()=>{const d=setTimeout(()=>{a&&c(e.urlLoginAs)?o.current.focus():!c(e.urlLoginAs)&&a&&c(b)&&c(A)&&l.current.focus()},1);return()=>clearTimeout(d)},[]);const C=d=>{var D;d.preventDefault(),((D=e.sisPart)==null?void 0:D.fPermissaoPartilhaDados)==="V"?h(!0):r.current.submit()},S=d=>{r.current.submit()};return s.jsxs("form",{name:"loginCCForm",method:"post",className:t("d-flex","gap-3","flex-column"),action:e.urlLoginCC?e.urlLoginCC:"/unauthed/v2/requestLogoutPreLoginCC",ref:r,onSubmit:C,children:[s.jsx(B,{open:p,children:s.jsxs(T,{color:"neutral",size:"md",children:[s.jsx(U,{children:s.jsx(V,{children:"Consentimento de Dados Pessoais"})}),s.jsx(q,{children:s.jsxs(W,{children:[s.jsx("div",{className:i.wrapperLogoSP,children:s.jsx("img",{className:t(i.logoSP,"p-0"),alt:"Logo "+((F=e.sisPart)==null?void 0:F.ndescr),src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)})}),s.jsx("br",{}),"Autorizo que o meu ",s.jsx("b",{children:"NÃºmero de Contribuinte"})," e ",s.jsx("b",{children:"Nome"})," sejam fornecidos Ã  entidade ",s.jsx("b",{children:(f=e.sisPart)==null?void 0:f.ndescr}),"."]})}),s.jsxs(H,{className:t("d-flex","gap-2"),children:[s.jsx(G,{children:s.jsx(g,{className:"secundaryButton",onClick:()=>h(!1),children:"NÃ£o Autorizo"})}),s.jsx(Q,{children:s.jsx(g,{className:"primaryButton",onClick:S,children:"Autorizo"})})]})]})}),s.jsx("p",{className:i.chaveMovel,children:"FaÃ§a a sua autenticaÃ§Ã£o com CartÃ£o de CidadÃ£o ou Chave MÃ³vel Digital"}),e.urlLoginAs&&s.jsxs(s.Fragment,{children:[s.jsxs(R,{children:[s.jsx(L,{children:"Representado"}),s.jsx(_,{title:"Insira um nÃºmero de contribuÃ­nte vÃ¡lido",placeholder:"NÂº de Contribuinte",readOnly:!0,value:j,status:((y=e.fieldError)==null?void 0:y.field)==="representado"&&((x=e.submitNIFForm)==null?void 0:x.selectedAuthMethod)==="C"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]}),s.jsxs(R,{children:[s.jsx(L,{children:"Representante"}),s.jsx(_,{readOnly:!c(b)||!c(A),ref:l,title:"Insira um nÃºmero de contribuÃ­nte vÃ¡lido",placeholder:"NÂº de Contribuinte",value:I,status:((M=e.fieldError)==null?void 0:M.field)==="username"&&((P=e.submitNIFForm)==null?void 0:P.selectedAuthMethod)==="C"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]})]}),e.attributes&&Object.keys(e.attributes).map(d=>s.jsx("input",{type:"hidden",name:d,value:e.attributes[d]},d)),e.attributes&&Object.keys(e.attributes).find(d=>d==="authVersion")==null&&s.jsx("input",{type:"hidden",name:"authVersion",value:e.authVersion}),e.isMultipleAuthentication&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"hidden",name:"nifInAuthentication",value:e.nifInAuthentication}),e.multipleAuthenticationRequestId&&s.jsx("input",{type:"hidden",name:"multipleAuthenticationRequestId",value:e.multipleAuthenticationRequestId})]}),e.urlLoginCCOriginal&&s.jsx("input",{type:"hidden",name:"originalUrl",value:e.urlLoginCCOriginal}),s.jsx("input",{type:"hidden",name:e._csrf.parameterName,value:e._csrf.token}),s.jsx("input",{type:"hidden",name:"selectedAuthMethod",value:"C"}),((E=e.sisPart)==null?void 0:E.fPermissaoPartilhaDados)==="V"&&s.jsx("input",{type:"hidden",name:"envioDadosPessoaisCC",value:"on"}),s.jsx(g,{className:t(i.submit,i.cc),name:"Autenticar com Chave MÃ³vel Digital",type:"submit",color:"primary",ref:o,children:s.jsx("img",{src:"/autentica_static/images/cc.png",width:175,height:35,alt:"Logo AutenticaÃ§Ã£o Gov"})})]})}function qe({model:e}){var A,j,I,C,S,F,f,y;const[a,r]=n.useState(!1),o=n.useRef(null),l=n.useRef(null),p=n.useRef(null),h=!c(e.infoMessage)&&!c(e.submitEORIForm.eoriUsername)||e.usernameReadonly,u=$({initialValues:{eoriUsername:((A=e.submitEORIForm)==null?void 0:A.eoriUsername)??"",password:"",envioDadosPessoais:!1},validate:{eoriUsername:x=>k({required:!0,value:x,validator:be}),password:x=>k({maxLength:20,required:!0,value:x})}});n.useEffect(()=>{const x=setTimeout(()=>{h?(!c(e.action)&&!c(e.submitEORIForm.eoriUsername)||h)&&p.current.focus():l.current.focus()},1);return()=>clearTimeout(x)},[]);const m=x=>{var P;x.preventDefault(),!u.validate().hasErrors&&(((P=e.sisPart)==null?void 0:P.fPermissaoPartilhaDados)==="V"?r(!0):o.current.submit())},b=x=>{o.current.submit()};return s.jsxs("form",{name:"login-eori-form",autoComplete:"off",ref:o,onSubmit:m,className:t("d-flex","flex-column","gap-2"),noValidate:!0,action:e.urlLoginEORI,method:"POST",children:[s.jsx(B,{open:a,children:s.jsxs(T,{color:"neutral",size:"md",children:[s.jsx(U,{children:s.jsx(V,{children:"Consentimento de Dados Pessoais"})}),s.jsx(q,{children:s.jsxs(W,{children:[s.jsx("div",{className:i.wrapperLogoSP,children:s.jsx("img",{className:t(i.logoSP,"p-0"),alt:"Logo "+((j=e.sisPart)==null?void 0:j.ndescr),src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)})}),s.jsx("br",{}),"Autorizo que o meu identificador ",s.jsx("b",{children:"EORI"})," e ",s.jsx("b",{children:"Nome"})," sejam fornecidos Ã  entidade ","entidade ",s.jsx("b",{children:(I=e.sisPart)==null?void 0:I.ndescr}),"."]})}),s.jsxs(H,{className:t("d-flex","gap-2"),children:[s.jsx(G,{children:s.jsx(g,{className:"secundaryButton",onClick:()=>r(!1),children:"NÃ£o Autorizo"})}),s.jsx(Q,{children:s.jsx(g,{className:"primaryButton",onClick:b,children:"Autorizo"})})]})]})}),s.jsxs(R,{children:[s.jsx(L,{containerProps:{className:"d-none"},children:"NÃºmero de Contribuinte"}),s.jsx(_,{name:"eoriUsername",showClearButton:"auto",maxLength:19,placeholder:"EORI Id",...u.getInputProps("eoriUsername"),title:"Insira um EORI vÃ¡lido",readOnly:h,ref:l,status:!c(u.errors.eoriUsername)||((C=e.fieldError)==null?void 0:C.field)==="eoriUsername"&&((S=e.submitNIFForm)==null?void 0:S.selectedAuthMethod)==="E"?"invalid":void 0,endAdornment:s.jsx(ae,{errorValue:u.errors.eoriUsername}),startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]}),s.jsxs(R,{children:[s.jsx(L,{containerProps:{className:"d-none"},children:"Senha de acesso"}),s.jsx(ie,{spellCheck:!1,name:"password",placeholder:"EORI Password",errorValue:u.errors.password,passwordref:p,showClearButton:"auto",title:"Campo ObrigatÃ³rio",...u.getInputProps("password"),maxLength:20,status:!c(u.errors.password)||((F=e.fieldError)==null?void 0:F.field)==="password"&&((f=e.submitNIFForm)==null?void 0:f.selectedAuthMethod)==="E"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Password",icon:"key",title:"Password",size:"xl"})})})]}),((y=e.sisPart)==null?void 0:y.fPermissaoPartilhaDados)==="V"&&s.jsx("input",{type:"hidden",name:"envioDadosPessoais",value:"on"}),e.submitNIFForm.predefinedUsername&&s.jsx("input",{type:"hidden",name:"predefinedUsername",value:e.submitNIFForm.predefinedUsername}),e.attributes&&Object.keys(e.attributes).map(x=>s.jsx("input",{type:"hidden",name:x,value:e.attributes[x]},x)),s.jsx("input",{type:"hidden",name:"selectedAuthMethod",value:"E"}),s.jsx("input",{type:"hidden",name:e._csrf.parameterName,value:e._csrf.token}),e.attributes&&Object.keys(e.attributes).find(x=>x==="authVersion")==null&&s.jsx("input",{type:"hidden",name:"authVersion",value:e.authVersion}),e.submitNIFForm.predefinedUsername&&s.jsx("input",{type:"hidden",name:"predefinedUsername",value:e.submitNIFForm.predefinedUsername}),s.jsx(g,{type:"submit",className:"primaryButton",children:"Autenticar"})]})}function _e({model:e,selectedTab:a}){var C,S,F,f,y,x,M,P,E;const[r,o]=n.useState(!1),l=e.attributes.nifRepresentado,p=e.attributes.idRepresentado,h=e.attributes.nifRepresentante,u=e.attributes.idRepresentante,m=n.useRef(null),b=n.useRef(null),A=n.useRef(null),j=$({initialValues:{representado:l||p,representante:h||(e.submitNIFForm.username?e.submitNIFForm.username:u),password:""},validate:{representado:d=>k({required:!0,value:d,validator:ee}),representante:d=>k({required:!0,value:d,validator:ee}),password:d=>k({required:!0,value:d,minLength:8,maxLength:16})}}),I=d=>{var w;d.preventDefault(),j.validate().hasErrors||(((w=e.sisPart)==null?void 0:w.fPermissaoPartilhaDados)==="V"?o(!0):m.current.submit())};return n.useEffect(()=>{const d=setTimeout(()=>{!c(e.urlLoginAs)&&a&&c(h)&&c(u)?b.current.focus():a&&!c(h)&&!c(u)&&A.current.focus()},1);return()=>clearTimeout(d)},[]),s.jsxs("form",{name:"loginForm",autoComplete:"off",ref:m,onSubmit:I,className:t("d-flex","flex-column","gap-2"),noValidate:!0,action:e.urlLoginAs,method:"POST",children:[s.jsx(B,{open:r,children:s.jsxs(T,{color:"neutral",size:"md",children:[s.jsx(U,{children:s.jsx(V,{children:"Consentimento de Dados Pessoais"})}),s.jsx(q,{children:s.jsxs(W,{children:[s.jsx("div",{className:i.wrapperLogoSP,children:s.jsx("img",{className:t(i.logoSP,"p-0"),alt:"Logo "+((C=e.sisPart)==null?void 0:C.ndescr),src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)})}),s.jsx("br",{}),"Autorizo que o meu ",s.jsx("b",{children:"NÃºmero de Contribuinte"})," e ",s.jsx("b",{children:"Nome"})," sejam fornecidos Ã  entidade ",s.jsx("b",{children:(S=e.sisPart)==null?void 0:S.ndescr}),"."]})}),s.jsxs(H,{className:t("d-flex","gap-2"),children:[s.jsx(G,{children:s.jsx(g,{className:"secundaryButton",onClick:()=>o(!1),children:"NÃ£o Autorizo"})}),s.jsx(Q,{children:s.jsx(g,{className:"primaryButton",onClick:()=>m.current.submit(),children:"Autorizo"})})]})]})}),s.jsxs(R,{children:[s.jsx(L,{children:"Representado"}),s.jsx(_,{name:"representado",title:"Insira um nÃºmero de contribuÃ­nte vÃ¡lido",placeholder:"NÂº de Contribuinte",readOnly:!0,...j.getInputProps("representado"),status:((F=e.fieldError)==null?void 0:F.field)==="representado"&&((f=e.submitNIFForm)==null?void 0:f.selectedAuthMethod)==="N"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]}),s.jsxs(R,{children:[s.jsx(L,{children:"Representante"}),s.jsx(_,{name:"username",readOnly:!c(h)||!c(u),title:"Insira um nÃºmero de contribuÃ­nte vÃ¡lido",placeholder:"NÂº de Contribuinte",...j.getInputProps("representante"),status:((y=e.fieldError)==null?void 0:y.field)==="username"&&((x=e.submitNIFForm)==null?void 0:x.selectedAuthMethod)==="N"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"xl"})})})]}),s.jsxs(R,{className:"hideLabel",children:[s.jsx(L,{children:"Senha de acesso"}),s.jsx(ie,{spellCheck:!1,name:"password",placeholder:"Senha de Acesso",errorValue:j.errors.password,showClearButton:"auto",title:"Campo ObrigatÃ³rio",...j.getInputProps("password"),status:!c(j.errors.password)||((M=e.fieldError)==null?void 0:M.field)==="password"&&((P=e.submitNIFForm)==null?void 0:P.selectedAuthMethod)==="N"?"invalid":void 0,startAdornment:s.jsx("div",{className:i.loginIconContainer,children:s.jsx(N,{label:"Password",icon:"key",title:"Password",size:"xl"})})})]}),((E=e.sisPart)==null?void 0:E.fPermissaoPartilhaDados)==="V"&&s.jsx("input",{type:"hidden",name:"envioDadosPessoais",value:"on"}),e.attributes&&Object.keys(e.attributes).map(d=>s.jsx("input",{type:"hidden",name:d,value:e.attributes[d]},d)),s.jsx("input",{type:"hidden",name:"selectedAuthMethod",value:"N"}),s.jsx("input",{type:"hidden",name:e._csrf.parameterName,value:e._csrf.token}),e.attributes&&Object.keys(e.attributes).find(d=>d==="authVersion")==null&&s.jsx("input",{type:"hidden",name:"authVersion",value:e.authVersion}),s.jsx(g,{type:"submit",className:"primaryButton",children:"Autenticar"})]})}const te=({model:e,showRegisterLink:a,className:r,id:o})=>{let l=e.authMethods||[];l=e.isMultipleAuthentication?l.filter(m=>m!=="E"):l;const p=()=>{var m;return e.logoutSuccess||e.loginSuccess?"N":e.activeLoginTab?e.activeLoginTab:e.authMethods.length<=0?"":((m=e.authMethods)==null?void 0:m.indexOf("N"))!=-1?"N":e.authMethods[0]},[h,u]=n.useState(p());return s.jsxs(O,{className:t("m-0",i.form,r),id:o,children:[s.jsxs(Ae,{activationMode:"automatic",onValueChange:m=>u(m),defaultValue:h,variant:"underlined",className:"p-0",children:[(l.length>1||e.logoutSuccess||e.loginSuccess)&&s.jsxs(Ne,{className:t("justify-content-between"),children:[(e.logoutSuccess||e.loginSuccess||l.indexOf("C")!=-1)&&s.jsx(X,{value:"C",className:i.tab,children:"CC / CMD"}),(e.logoutSuccess||e.loginSuccess||l.indexOf("N")!=-1)&&s.jsx(X,{value:"N",className:i.tab,children:"NIF"}),(e.logoutSuccess||e.loginSuccess||l.indexOf("E")!=-1)&&s.jsx(X,{value:"E",className:i.tab,children:"EORI"})]}),(e.logoutSuccess||e.loginSuccess||l.indexOf("C")!=-1)&&s.jsx(Y,{value:"C",className:i.tabContent,children:s.jsx(Ve,{model:e,selectedTab:h==="C"})}),(e.logoutSuccess||e.loginSuccess||l.indexOf("N")!=-1)&&s.jsx(Y,{value:"N",className:i.tabContent,children:c(e.urlLoginAs)?s.jsx(Ue,{model:e}):s.jsx(_e,{model:e,selectedTab:h==="N"})}),(e.logoutSuccess||e.loginSuccess||l.indexOf("E")!=-1)&&s.jsx(Y,{value:"E",className:i.tabContent,children:s.jsx(qe,{model:e})})]}),s.jsxs("div",{className:t("p-0","d-flex","flex-column","gap-2"),children:[s.jsx("a",{className:t(i.link,"mx-auto"),href:"/unauthed/recuperarSenhaEscolhaForm"+Z(e),children:"Recuperar senha de acesso"}),(!e.isMultipleAuthentication||e.isPrincipalAuth)&&s.jsx("a",{className:t(i.link,"mx-auto"),href:"/alterarDadosAcessoForm"+Z(e),children:"Alterar dados de acesso"}),(!e.isMultipleAuthentication||e.isPrincipalAuth||a)&&s.jsx("div",{className:i.registar,children:s.jsxs("p",{className:t(i.link,"pt-2","mb-0","mt-2"),children:["NÃ£o tem uma conta? ",s.jsx("a",{href:"/unauthed/novoUtilizadorForm"+Z(e),children:"Registe-se"})]})})]})]})},Z=e=>{let a="";return a+="?partID="+e.partID,c(e.path)||(a+="&path="+e.path),c(e.authMethods.join())||(a+="&authMethods="+e.authMethods.join()),a};function He(e){let a=e.multipleAuthenticationViewBeanList||[];return a=[...a].sort((r,o)=>me(r)-me(o)),s.jsx("ul",{id:e.id,className:t("d-flex","flex-column","m-0","gap-2","p-0","py-md-1","list-unstyled",z.userList),children:a.map(r=>{var o;return s.jsxs("li",{className:t("d-flex","flex-column"),children:[s.jsxs(g,{className:t("d-flex","gap-3","align-items-center","mx-md-2","py-2","px-3","justify-content-between",z.user,fe(r),r.situacaoId==="autenticar"&&!e.nifInAuthentication&&z.clickable),"aria-label":Qe(r,!c(e.nifInAuthentication)),onClick:()=>{r.situacaoId==="autenticar"&&!e.nifInAuthentication&&(window.location.href=r.situacaoUri)},children:[s.jsx(N,{label:"Utilizador",icon:"circle-user",title:"Utilizador",size:"3xl"}),s.jsxs("div",{className:t("d-flex","flex-column","gap-1"),children:[s.jsx("span",{children:s.jsx("b",{children:r.user})}),s.jsx("span",{children:r.actor})]}),s.jsx(Ie,{color:Ge(r),variant:"outlined",className:t(z.situacao,"px-1"),children:r.situacao}),We(r)]},r.user),((o=e.nifInAuthentication)==null?void 0:o.includes(r.user))&&s.jsx(te,{model:e,showRegisterLink:r.situacaoId==="NotExists",className:t(fe(r),z.borderBottom,"d-md-none","pt-3","row-gap-3")})]})})})}const We=e=>{if(e.situacaoErro)return s.jsx(N,{label:e.situacaoDescricao,icon:"circle-exclamation",size:"3xl",title:e.situacaoDescricao,color:"danger"});if(e.situacaoId==="autenticar")return s.jsx(N,{label:e.situacaoDescricao,icon:"lock",size:"3xl",title:e.situacaoDescricao});if(e.situacaoId==="emAutenticacao"||e.situacaoId==="ccAuthenticationCanceled")return s.jsx(N,{label:e.situacaoDescricao,icon:"right-to-bracket",size:"3xl",title:e.situacaoDescricao,className:"icon-blue"});if(e.situacaoId==="autenticado"||e.situacaoId==="autenticadoRepresentacao")return s.jsx(N,{label:e.situacaoDescricao,icon:"lock-open",size:"3xl",title:e.situacaoDescricao,color:"success"})},Ge=e=>{if(e.situacaoErro)return"danger";if(e.situacaoId==="autenticar")return"neutral";if(e.situacaoId==="emAutenticacao"||e.situacaoId==="ccAuthenticationCanceled")return"primary";if(e.situacaoId==="autenticado"||e.situacaoId==="autenticadoRepresentacao")return"success"},fe=e=>{if(e.situacaoErro)return z.authError;if(e.situacaoId==="autenticar")return"";if(e.situacaoId==="emAutenticacao"||e.situacaoId==="ccAuthenticationCanceled")return z.inAuthentication;if(e.situacaoId==="autenticado"||e.situacaoId==="autenticadoRepresentacao")return z.authenticated},me=e=>e.situacaoErro?0:e.situacaoId==="autenticar"?2:e.situacaoId==="emAutenticacao"||e.situacaoId==="ccAuthenticationCanceled"?1:e.situacaoId==="autenticado"||e.situacaoId==="autenticadoRepresentacao"?3:1e3,Qe=(e,a)=>e.situacaoId==="autenticar"?a?e.actor+" com NIF "+e.user+" nÃ£o estÃ¡ autenticado":"Autenticar "+e.actor+" com NIF "+e.user:e.situacaoId==="emAutenticacao"?e.actor+" com NIF "+e.user+" estÃ¡ a ser autenticado":e.situacaoId==="autenticado"?e.actor+" com NIF "+e.user+" jÃ¡ estÃ¡ autenticado":e.situacaoErro?"Ocorreu um erro ao autenticar "+e.actor+" com NIF "+e.user:"";function Je(e){const a=document.getElementById("forwardParticipantForm"),r=document.getElementById("forwardCadpfForm"),[o,l]=n.useState(e.show2FaModal),[p,h]=n.useState(e.showFiabilizacaoModal);n.useEffect(()=>{if(!e.show2FaModal&&!e.showFiabilizacaoModal){const b=setTimeout(()=>{a.submit()},250);return()=>clearTimeout(b)}},[]);const u=()=>{l(!1),h(!1);const b=setTimeout(()=>{a.submit()},250);return()=>clearTimeout(b)},m=()=>{r.submit()};return s.jsxs(s.Fragment,{children:[s.jsx(B,{open:!o&&!p,children:s.jsxs(T,{color:"success",variant:"solid",size:"lg",children:[s.jsx(U,{children:s.jsx(V,{children:s.jsxs(Ce,{alignItems:"center",justifyContent:"space-between",direction:"row",children:[e.isCancelar?"AutenticaÃ§Ã£o cancelada":"Foi autenticado com sucesso",s.jsx("img",{src:"/autentica_static/images/spinner.gif",width:40,height:40,alt:"A redirecionar","aria-label":"A redirecionar"})]})})}),s.jsx(q,{children:s.jsxs(W,{children:[s.jsx("p",{children:"EstÃ¡ a ser redirecionado de forma segura para o serviÃ§o solicitado. Por favor aguarde..."}),s.jsxs("p",{children:["Se nÃ£o for redirecionado dentro de segundos, por favor ",s.jsx("input",{type:"submit",value:"clique aqui",className:"underlineButton"}),"."]})]})})]})}),s.jsx(B,{open:o,children:s.jsxs(T,{size:"lg",color:"primary",children:[s.jsx(U,{children:s.jsx(V,{children:"Adira ao Segundo Fator de AutenticaÃ§Ã£o"})}),s.jsxs(q,{children:[s.jsxs("p",{children:["Reforce a seguranÃ§a da sua conta ao ativar o Segundo Fator de AutenticaÃ§Ã£o (2FA).",s.jsx("br",{}),"Com o 2FA, alÃ©m da sua senha, serÃ¡ necessÃ¡rio confirmar a sua identidade com um cÃ³digo Ãºnico enviado por SMS.",s.jsx("br",{}),"O 2FA impede o acesso de terceiros aos seus dados pessoais, incluindo nas situaÃ§Ãµes em que a senha possa ter ficado comprometida."]}),s.jsxs("p",{className:"mt-3",children:["Como funciona?",s.jsxs("ol",{children:[s.jsx("li",{children:"Inicie a autenticaÃ§Ã£o com as suas credenciais (NIF e senha)."}),s.jsx("li",{children:"IrÃ¡ receber um cÃ³digo de seguranÃ§a via SMS no seu telefone confirmado."}),s.jsx("li",{children:"Insira o cÃ³digo para completar a autenticaÃ§Ã£o."})]})]}),s.jsx("p",{className:"mt-3",children:'Clique em "Aderir" para ativar o 2FA.'})]}),s.jsxs(H,{className:"d-flex gap-2 justify-content-end",children:[s.jsx(g,{className:"w-auto secundaryButton",onClick:u,children:"Continuar Login"}),s.jsx(g,{className:"w-auto primaryButton",onClick:()=>window.location.href="/adesaoTwoFactorForm?partID="+e.partID,children:"Aderir"})]})]})}),s.jsx(B,{open:p,children:s.jsxs(T,{size:"lg",color:"primary",children:[s.jsx(U,{children:s.jsx(V,{children:"ConfirmaÃ§Ã£o do contacto telefÃ³nico"})}),s.jsxs(q,{children:[s.jsx("p",{children:"Confirme o seu contacto telefÃ³nico."}),s.jsx("p",{className:"mt-3",children:'Clique em "Confirmar" para validar o seu contacto telefÃ³nico.'})]}),s.jsxs(H,{className:"d-flex gap-2 justify-content-end",children:[s.jsx(g,{className:"w-auto secundaryButton",onClick:u,children:"Continuar Login"}),s.jsx(g,{className:"w-auto primaryButton",onClick:m,children:"Confirmar"})]})]})})]})}function $e(e){return s.jsx(Fe,{defaultOpen:e.logoutSuccess,children:s.jsxs(Se,{color:"success",variant:"solid",size:"lg",children:[s.jsx(Pe,{className:"mb-3",children:s.jsx(ye,{children:"SessÃ£o terminada com sucesso"})}),s.jsx(we,{children:s.jsxs(Re,{children:[s.jsx("p",{children:"A sua sessÃ£o no Portal das FinanÃ§as foi terminada."}),s.jsx("p",{children:"Pode voltar ao Portal atravÃ©s do botÃ£o que se segue, ou iniciar novamente a sessÃ£o depois de fechar esta janela."}),e.showAlert&&s.jsx(se,{severity:"danger",variant:"solid",children:"O utilizador foi redirecionado para esta pÃ¡gina como resultado de um estado incoerente de sessÃ£o."})]})}),s.jsx(Le,{className:t("d-flex","gap-2","justify-content-end"),children:s.jsx(g,{asChild:!0,className:"secundaryButton",children:s.jsx("a",{href:e.urlPortal,children:"Voltar ao Portal"})})})]})})}const Ke=e=>e.length==6&&Me(e);function Xe(e){var ne,re,oe;const a=n.useRef(null),r=n.useRef(null),[o,l]=n.useState(null),[p,h]=n.useState(!1),[u,m]=n.useState(!1),[b,A]=n.useState(!1),[j,I]=n.useState(!1),[C,S]=n.useState(!1),[F,f]=n.useState(e.codeExpired2Fa==!0),[y,x]=n.useState(!0),[M,P]=n.useState(e.codeExpired2Fa?"danger":"info"),[E,d]=n.useState(e.codeExpired2Fa?"O Ãºltimo cÃ³digo enviado jÃ¡ nÃ£o Ã© vÃ¡lido. Por favor, solicite o envio de um novo cÃ³digo.":"Foi enviado um SMS para o nÃºmero "+e.phone+" contendo um cÃ³digo que deve inserir no campo abaixo para provar a sua identidade. Envios de novo cÃ³digo restantes: "+e.sendsRemaining),D={partID:e.partID};e.issuer&&(D.issuer=e.issuer),e.path&&(D.path=e.path);const w=$({initialValues:{nif:e.nifIn2FA,_csrf:e._csrf.token,codigoSms2Fa:""},validate:{codigoSms2Fa:v=>k({required:!0,validator:Ke,value:v,minLength:6,maxLength:6})},initialErrors:{codigoSms2Fa:((ne=e.fieldError)==null?void 0:ne.field)==="codigoSms2Fa"?(re=e.fieldError)==null?void 0:re.errorMsg:void 0}});n.useEffect(()=>(setTimeout(()=>{r.current&&!e.smsFailed&&r.current.focus()},10),()=>{o&&clearTimeout(o)}),[p]),n.useEffect(()=>(e.codeExpired2Fa||K(),()=>{o!=null&&o.ref()&&clearTimeout(o==null?void 0:o.ref())}),[]);const K=()=>{o&&clearTimeout(o),A(!0);const v=setTimeout(()=>{A(!1)},15e3);l(v)},ge=()=>{j||(I(!0),xe({url:"/reenviarCodigo",params:{...D,isLogin:!0},csrfToken:e._csrf.token,successHandler:v=>{v.smsFailed?(d("Ocorreu um erro no envio do SMS para o seu nÃºmero de telemÃ³vel. Por favor tente mais tarde."),P("danger"),K()):v.newCode?(w.setFieldValue("codigoSms2Fa",""),w.clearErrors(),K(),f(!1),d("Foi enviado um SMS para o nÃºmero "+e.phone+" contendo um novo cÃ³digo. Este cÃ³digo tem uma validade de 5 minutos. Envios de novo cÃ³digo restantes: "+v.sendsRemaining),P("info")):(S(!0),d("Ultrapassou o limite de envios do cÃ³digo SMS. As suas credenciais estÃ£o suspensas durante uma hora."),P("danger"))},errorHandler:({redirectUrl:v})=>window.location.href=v,setIsLoading:h,minWait:500})),I(!1)},ve=()=>{j||(I(!0),xe({url:"/cancelarLogin2Fa",params:D,csrfToken:e._csrf.token,successHandler:()=>{x(!1)},errorHandler:({redirectUrl:v})=>window.location.href=v,setIsLoading:m,minWait:500}))};return s.jsx(B,{open:y,children:s.jsxs(T,{size:"lg",children:[s.jsx(U,{children:s.jsx(V,{children:"Segundo Fator de AutenticaÃ§Ã£o"})}),s.jsxs(q,{className:t("d-flex","flex-column","gap-4"),children:[M&&E&&s.jsx(se,{severity:M,children:E}),s.jsxs("form",{name:"form2FA",id:"form2FA",action:e.urlLogin,ref:a,method:"post",autoComplete:"off",onSubmit:v=>{v.preventDefault(),j||w.validate().hasErrors||(I(!0),a.current.submit())},children:[s.jsx("input",{type:"hidden",name:e._csrf.parameterName,value:e._csrf.token}),e.attributes&&Object.keys(e.attributes).find(v=>v==="authVersion")==null&&s.jsx("input",{type:"hidden",name:"authVersion",value:e.authVersion}),((oe=e.sisPart)==null?void 0:oe.fPermissaoPartilhaDados)==="V"&&s.jsx("input",{type:"hidden",name:"envioDadosPessoais",value:"on"}),e.attributes&&Object.keys(e.attributes).map(v=>s.jsx("input",{type:"hidden",name:v,value:e.attributes[v]},v)),s.jsx("input",{type:"hidden",name:"selectedAuthMethod",value:"N"}),s.jsxs(O,{className:t("mx-0","gap-4"),children:[s.jsx(J,{xs:12,md:6,className:t("px-0","flex-1"),children:s.jsxs(R,{children:[s.jsx(L,{children:"NÃºmero de IdentificaÃ§Ã£o Fiscal"}),s.jsx(_,{title:"NÃºmero de IdentificaÃ§Ã£o Fiscal",name:"nif",readOnly:!0,...w.getInputProps("nif")})]})}),s.jsx(J,{xs:12,md:6,className:t("px-0","flex-1"),children:s.jsxs(R,{children:[s.jsx(L,{children:"CÃ³digo SMS"}),s.jsx(_,{status:Ee(w.errors.codigoSms2Fa),showClearButton:!0,required:!0,maxLength:6,autoFocus:!0,placeholder:"CÃ³digo SMS",disabled:C||p||e.smsFailed,type:"tel",name:"codigoSms2Fa",id:"codigoSms2Fa",ref:r,endAdornment:s.jsx(ae,{errorValue:w.errors.codigoSms2Fa}),...w.getInputProps("codigoSms2Fa"),onChange:v=>{const ce=De(v.target.value);w.setFieldValue("codigoSms2Fa",ce)}})]})})]}),e.globalError&&s.jsx(se,{severity:"danger",variant:"solid",children:e.globalError})]})]}),s.jsxs(H,{className:t("gap-2"),children:[s.jsx(G,{children:s.jsx(g,{className:t("w-auto","secundaryButton"),disabled:j,onClick:()=>ve(),loading:u,children:"Cancelar"})}),s.jsx(Q,{children:s.jsxs(O,{className:t("m-0","gap-2"),children:[s.jsx(g,{className:t("w-auto","secundaryButton"),onClick:()=>{ge()},loading:p,disabled:p||b||C||j,children:p?"A reenviar cÃ³digo":"Reenviar CÃ³digo"}),s.jsx(g,{type:"submit",form:"form2FA",className:t("w-auto","primaryButton"),disabled:F||j||C,children:"Autenticar"})]})})]})]})})}window.startLogin=e=>{Oe(document.getElementById("root")).render(s.jsx(ze,{children:s.jsx(Ye,{...e})}))};function Ye(e){var h,u,m,b;const[a,r]=n.useState(!1);ke(r);const o=e.multipleAuthenticationViewBeanList?e.multipleAuthenticationViewBeanList.reduce((A,j)=>j.situacaoId==="autenticado"?A+1:A,0):0,l=e.multipleAuthenticationViewBeanList?e.multipleAuthenticationViewBeanList.length-o:0;let p=e.authMethods||[];return p=e.isMultipleAuthentication?p.filter(A=>A!=="E"):p,s.jsxs("main",{className:t("d-flex","row","m-0",i.container),children:[e.infoMessage&&!e.is2FA&&s.jsxs(ue,{severity:"info",defaultOpen:!0,showCloseButton:!0,title:"InformaÃ§Ã£o",duration:6e4,children:[s.jsx(le,{children:"InformaÃ§Ã£o"}),s.jsx(de,{children:e.infoMessage})]}),(e.globalError||e.fieldError)&&!e.is2FA&&s.jsxs(ue,{severity:"danger",defaultOpen:!0,showCloseButton:!0,title:"Erro",duration:6e4,children:[s.jsx(le,{children:"Erro"}),s.jsx(de,{dangerouslySetInnerHTML:{__html:e.globalError?e.globalError:e.fieldError.errorMsg}})]}),s.jsx(Be,{href:!e.isMultipleAuthentication||e.nifInAuthentication||e.isPrincipalAuth||e.showLoginForm?"#login-form":"#ma-list",text:"Saltar para o conteÃºdo principal"}),e.logoutSuccess&&s.jsx($e,{...e}),e.loginSuccess&&s.jsx(Je,{...e}),e.is2FA&&s.jsx(Xe,{...e}),s.jsxs(J,{xs:12,md:5,lg:6,className:t("p-0","justify-content-md-between","d-flex","flex-column","flex-shrink-1","h-100",i.leftCol),children:[s.jsx(O,{className:t("m-0","px-5","px-md-0"),children:e.isInternalSP?s.jsx("a",{href:e.urlPortal,target:"_blank",rel:"noopener noreferrer",className:t("w-auto","p-0","mx-auto","mx-md-0"),children:s.jsx("img",{className:t(i.iconAT),src:`${e.urlPfstatic}/images/logo-at.svg`,width:212,height:65,alt:"Autoridade TributÃ¡ria e Aduaneira",title:"Autoridade TributÃ¡ria e Aduaneira"})}):s.jsxs("div",{className:t("p-0","d-flex","flex-column"),children:[s.jsx("img",{className:t(i.iconAT,"m-auto","m-md-0"),alt:(h=e.sisPart)==null?void 0:h.ndescr,src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)}),s.jsx("span",{className:t(i.descricaoSP,"my-4"),children:(u=e.sisPart)==null?void 0:u.ndescr})]})}),(!e.isMultipleAuthentication||e.isPrincipalAuth)&&e.isInternalSP&&s.jsxs(O,{className:t("m-0","px-5","px-md-0"),children:[s.jsxs("h1",{className:t(i.bemVindo,"p-0","d-none","d-md-block","mb-5"),children:["Bem-vindo",s.jsx("br",{}),"ao serviÃ§o de autenticaÃ§Ã£o da AT."]}),s.jsx("span",{className:t("p-0","my-4","my-md-0"),children:"Autentique-se para aceder aos serviÃ§os."})]}),!e.logoutSuccess&&!e.isInternalSP&&s.jsx("h1",{className:t(i.SPtext,"d-none","d-md-flex","m-0"),children:(m=e.sisPart)==null?void 0:m.ntextsp}),(!e.isMultipleAuthentication||e.isPrincipalAuth||e.logoutSuccess||e.loginSuccess)&&s.jsx(he.Provider,{value:{capsLockOn:a},children:s.jsx(te,{className:"d-md-none",model:e})}),e.isMultipleAuthentication&&!e.isPrincipalAuth&&e.multipleAuthenticationViewBeanList&&s.jsxs(O,{className:t("m-0","p-0","text-center"),children:[s.jsx("span",{className:t("my-4","px-5","px-md-0"),children:e.infoMsg}),s.jsxs("span",{className:t("d-md-none","px-5","px-md-0","mb-4"),children:[o,"/",e.multipleAuthenticationViewBeanList.length," Utilizadores Autenticados"]}),s.jsx(He,{...e,id:"ma-list"}),s.jsxs("div",{className:t("w-100","d-flex","align-items-center","mt-2","mb-4"),children:[s.jsxs("span",{className:t("d-none","d-md-block"),children:[l>1?"Restam":"Resta"," autenticar ",l," ",l>1?"utilizadores":"utilizador","."]}),s.jsxs("div",{className:t("ms-auto","d-flex","gap-3"),children:[s.jsx(g,{asChild:!0,className:t("w-auto","secundaryButton"),children:s.jsx("a",{href:"/v2/cancelar"+je(e),children:"Cancelar"})}),e.showConcluir&&s.jsx(g,{asChild:!0,className:t("w-auto",!e.showLoginForm||!e.existAnyUserToAuthenticate?"primaryButton":"secundaryButton"),children:s.jsx("a",{href:"/v2/concluir"+je(e),children:"Concluir"})})]})]})]}),s.jsx(pe,{footer:e.footer,className:t("mx-auto","my-4","d-md-none",i.link)}),s.jsx(Te,{urlPortal:e.urlPortal,urlPfstatic:e.urlPfstatic,isExternalSP:!e.isInternalSP}),s.jsxs("p",{className:t("version","login"),children:[e.version," - ",e.versionDate]})]}),s.jsxs(J,{md:6,lg:5,className:t("d-none","d-md-flex","flex-column","justify-content-between","gap-3","flex-1","text-center","h-100",i.rightCol),children:[!e.logoutSuccess&&!e.isInternalSP&&s.jsx("img",{className:t(i.logoSP,"p-0","d-md-none","mt-4"),alt:"Logo "+((b=e.sisPart)==null?void 0:b.ndescr),src:"data:image/png;base64,"+(e==null?void 0:e.logoSP)}),!e.isMultipleAuthentication||e.nifInAuthentication||e.isPrincipalAuth||e.showLoginForm?s.jsxs(s.Fragment,{children:[s.jsxs(O,{className:t("d-none","d-md-block","m-0"),children:[s.jsx("h2",{className:i.entrar,children:"Entrar"}),p.length>1&&s.jsx("p",{className:t("m-0",i.escolha),children:"Escolha a opÃ§Ã£o de autenticaÃ§Ã£o e introduza os seus dados"})]}),s.jsx(he.Provider,{value:{capsLockOn:a},children:s.jsx(te,{model:e,id:"login-form"})}),s.jsx(pe,{footer:e.footer,className:t("mx-auto","d-none","d-md-block",i.link)})]}):s.jsx(s.Fragment,{children:s.jsxs(O,{className:t("m-0","flex-column","gap-4","my-auto",!e.existAnyUserToAuthenticate||e.showLoginForm&&"d-none"),children:[s.jsx("div",{className:"p-0",children:s.jsx(N,{icon:"users",className:"icon-blue",title:"AutenticaÃ§Ã£o MÃºltipla",label:"AutenticaÃ§Ã£o MÃºltipla",size:"7xl"})}),s.jsx("span",{className:"p-0",children:"Selecione o utilizador que se pretende autenticar."})]})})]})]})}const je=e=>{let a="";return a+="?partID="+e.partID,a+="&path="+e.path,a+="&issuer="+e.issuer,a+="&requiredQAALevel="+e.requiredQAALevel,a+="&authMethods="+e.authMethods.join(),a+="&requestedAttr="+e.requestedAttr,a+="&lastSubmitFormType="+e.lastSubmitFormType,a+="&action="+e.action,a+="&partDescr="+e.partDescr,a+="&showLoginForm="+e.showLoginForm,c(e.multipleAuthenticationRequestId)||(a+="&multipleAuthenticationRequestId="+e.multipleAuthenticationRequestId),e.isStartMA&&(a+="&listOfUsersIdTypes="+e.listOfUsersIdTypes,a+="&listOfUsersIds="+e.listOfUsersIds,a+="&listOfUsersActors="+e.listOfUsersActors,a+="&useAuthCache="+e.useAuthCache,a+="&fullAuth="+e.fullAuth,a+="&principal="+e.principal,c(e.actorID)||(a+="&actorID="+e.actorID),c(e.infoMsg)||(a+="&infoMsg="+e.infoMsg),c(e.transId)||(a+="&transId="+e.transId)),a};
